ENUNCIADO:

4) Acrescente ao programa do exercício 3, a geração de uma onda quadrada no pino
3 da porta P2 com período de 960 ciclos de instrução (ou seja, alterar o nível 
lógico do pino 3 da porta P2) Utilizando o Timer1 no modo0.


RESET 	EQU 0H
ITMR0 	EQU 0BH
ITMR1	EQU 1BH 
STATE 	EQU 20H

		ORG RESET
		JMP INICIO
		
		ORG ITMR0 ;LOCAL DO TRATADOR DA INTERRUPÇÃO TIMER0
		MOV STATE, #01H
		RETI
		
		ORG ITMR1 ;LOCAL DO TRATADOR DA INTERRUPÇÃO TIMER1
		CPL P2.3 ;COMPLEMENTAR O BIT 3 DA PORTA P2, GERAR A ONDA QUADRADA
		MOV TH1, #0E2H ;RECARREGAR O TH1 PARA CONTAGEM DO TIMER1 DE 960 CICLOS
		RETI
		
INICIO: MOV IE, #10001010B ;HABILITAR INTERRUPCAO TIMER0, TIMER1 E ENEBLE ALL
		MOV TMOD, #02H ;TIMER1 MODO 0 E TIMER0 MODO 2
		MOV TH0, #080H ; VALORES DE TH0 REABASTECE O TL0 (MODO 2)
		MOV TL0, #080H ;VAI CONTAR DE 128 A 256 5 VEZES PARA COMPLETAR O CICLO DE 640
		MOV TH1, #0E2H ;960/32 = 30, ISTO É, 30 CICLOS DE TL1 PARA COMPLETAROS 960 CICLOS DE INSTRUÇÕES
		MOV TL1, #0H ;CONTA 0 ATÉ 32 30 VEZES ATÉ COMPLETAR OS 960 CICLOS DE ISNTRUÇÃO
		MOV STATE, #0H 
		MOV R0, #STATE ;APONTA PARA STATE
		MOV DPTR, #TABELA ;APONTA PARA TABELA
		MOV R1, #0 
		MOV R3, #0 ;CONTADOR PARA OS 5 CICLOS DO TIMER0
		MOV P2,  #0 ;LIMPA P2 PARA NÃO TER LIXOS ANTES DAS INTERRUPÇÕES
		SETB TR0 ;DISPARAR O CONTADOR/TEMPORIZADOR
		SETB TR1 ;DISPARAR O CONTADOR/TEMPORIZADOR
		
VOLTA:	CJNE @R0, #1, VOLTA ;FICA PRESO ATÉ GERAR INTERRUPÇÕES
		MOV STATE, #0H ;5 VOLTAS DA INTERRUPÇÃO DO TIMER0
		INC R3  ;5 VOLTAS DA INTERRUPÇÃO DO TIMER0
		CJNE R3, #5, VOLTA ;5 VOLTAS DA INTERRUPÇÃO DO TIMER0
		MOV A, R1 
		MOVC A, @A+DPTR
		MOV P1, A
		INC R1
		CJNE R1, #16, VOLTA
		MOV R1, #0H 
		MOV R3, #0H
		JMP VOLTA

TABELA: DB 'Microcontrolador'
		END
		