ENUNCIADO:

4) Fazer um programa para transmitir pela interface serial
os valores de 41H a 61H de forma cíclica. Devem  ser trans-
mitidos 8 bits de dados à taxa de 19,2 kbits por segundo.
O programa deve também receber dados, armazenando os valores
recebidos na memória externa entre os endereços 00H e 09H.
Após completar o preenchimento desta região de memória, 
voltar a preechê-la com os dados recebidos a partir do ende-
reço inicial.



RESET 		EQU 00H
LTSERIAL	EQU 23H ; local tratador
STATE 		EQU 20H
F1			EQU PSW.1 ;F1 NÃO É ACEITO PRECISO COLOCA-LO  MANUALMENTE
		
			ORG RESET ;PC=0 depois de reset
			JMP INICIO
			
			ORG LTSERIAL ;AJEITAMOS O TRATADOR DE INTERRUPÇÃO PARA ROTINA DE TRANSMITIR/RECEBER
			JNB RI, TRANSMITIR ;COMPARA RI PARA VER SE ESTA SETADO, RI RECEIVE INTERRUPT
			CLR RI ;LIMPA RI
			SETB F0 ;F0 PROPOSITO GERAL USADO PELO PROGRAMADOR, USAMOS PARA PODER RECEBER/TRANSMITIR
TRANSMITIR: JNB TI, RETORNO ;COMPARA TI PARA VER SE ESTA SETADO, TI TRANSMIT INTERRUPT
 			CLR TI ;LIMPA TI
			SETB F1 ;F1  PROPOSITO GERAL USADO PELO PROGRAMADOR, USAMOS PARA PODER RECEBER/TRANSMITIR
RETORNO:	RETI
			
INICIO: 	MOV IE,#10010000B
			MOV SCON,#01010000B ;MODO 1,  REN = '1' -> PARA RECEBER
			MOV TMOD,#00100000B ;TIMER MODO 2
			MOV TH1,#0FDH ;TABELA MODO 3 PRECISA SER RECARREGADO COM FFH
			MOV TL1,#0FDH ;TABELA MODO 3 PRECISA SER RECARREGADO COM FFH
			MOV PCON,#80H ;10000000B SMOD = '1'
			MOV R3,#0H ;LOCAIS DE MEMÓRIA
			MOV R5, #41H ;DADO QUE SERÁ TRANSMITIDO
			SETB TR1 ;COMEÇA A CONTAR O TIMER1
			MOV SBUF, R5 ;COLOCA O VALOR DE R5 NO SBUF PARA TRANSMITIR PARA SERIAL
			
RECEBE: 	JNB F0, TRANSMITE ;COMPARA F0, SE NÃO FOR 1 PULA PARA TRANSMITIR
			CLR F0 ;LIMPA F0
			MOV DPL, R3
			MOV A, SBUF ;COLOCA  O VALOR DE SBUF EM A PARA GUARDA NA MEMÓRIA EXTERNA 
			MOVX @DPTR, A ;COLOCA O VALOR DE A NA POSIÇÃO DE MEMÓRIA APONTADA POR DPTR
			INC R3
			CJNE R3,  #0AH, TRANSMITE ;COMPARA R3 COM 0AH PARA PODER ARMAZENAR OS DADOS DE 0 ATÉ 09H
			MOV R3, #0H
			
TRANSMITE:	JNB F1, RECEBE ;SE F1 NÃO FOR 1 PULA PARA RECEBER
			CLR F1 ;LIMPA F1
			INC R5 ;INCREMENTA R5 PARA PROXIMAS LETRAS 
			MOV SBUF, R5 ;JOGA R5 EM SBUF PARA TRANSMITIR PARA SERIAL  
			MOV TB8, C ;JOGA O PARIDADE PRO TB8 NONO BIT DE TRANSMISSAO
			CJNE R5, #61, RECEBE 
			MOV R5, #40H
			JMP RECEBE
			END